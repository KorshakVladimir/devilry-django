{% extends "devilry_examiner/base.django.html" %}
{% load url from future %}
{% load i18n %}
{% load static %}
{% load devilry_examiner_tags %}

{% block title %}
{{ delivery.deadline.assignment_group.short_displayname }} #{{ delivery.number }} - {{ delivery.deadline.assignment_group.assignment.get_path }}
{% endblock %}

{% block body %}
    <div class="container">
        <div class="page-header page-header-with-subheader">
            <h1>
                {{ delivery.deadline.assignment_group.assignment.long_name }} &mdash; {{ delivery.deadline.assignment_group.long_displayname }}
            </h1>
            <p class="subheader">
                <span class="deliverynumber_and_total">
                    {% blocktrans with number=delivery.number total=delivery.deadline.assignment_group.successful_delivery_count %}
                        Delivery {{ number }}/{{ total }}
                    {% endblocktrans %}
                </span>
                -
                <span class="time_of_delivery">{{ delivery.time_of_delivery }}</span>
            </p>
        </div>
        <ol class="breadcrumb">
            <li><a href="{% url 'devilry_frontpage' %}">{% trans "Home" %}</a></li>
            <li><a href="{% url 'devilry_examiner_dashboard' %}">{% trans "Examiner" %}</a></li>
            <li><a href="{% url 'devilry_examiner_allgroupsoverview' delivery.deadline.assignment_group.assignment.id %}">{{ delivery.deadline.assignment_group.assignment.get_path }}</a></li>
            <li><a href="{% url 'devilry_examiner_singlegroupoverview' delivery.deadline.assignment_group.id %}">{{ delivery.deadline.assignment_group.short_displayname }}</a></li>
            <li class="active">#{{ delivery.number }}</li>
        </ol>

        {% if delivery.after_deadline %}
            <div class="alert alert-danger after_deadline_message">
                <strong>{% trans "This delivery was added 1 hour after the deadline." %}</strong>
                {% if delivery.deadline.successful_delivery_count > 1 %}
                    {% trans "The group has made at least one more delivery for this deadline." %}
                    <a href="{% url 'devilry_examiner_singlegroupoverview' delivery.deadline.assignment_group.id %}">
                        {% trans "Browse other deliveries" %}</a>.
                {% else %}
                    {% trans "The group has no other deliveries for this deadline." %}
                {% endif %}
            </div>
        {% endif %}

        {% if not delivery.is_last_delivery %}
            <div class="alert alert-warning not_last_delivery_message">
                {% trans "This delivery is not the last delivery made by this group on this assignment." %}
                <a href="{% url 'devilry_examiner_singlegroupoverview' delivery.deadline.assignment_group.id %}">
                        {% trans "Browse other deliveries" %}</a>.
            </div>
        {% endif %}

        {% with filemetacount=delivery.filemetas.count %}
            {% if filemetacount > 0 %}
                <div class="delivery_files">
                    {% if filemetacount == 1 %}
                        {% for filemeta in delivery.filemetas.all %}
                            <a href="#" class="btn btn-default">
                                <i class="fa fa-download"></i>
                                {{ filemeta.filename }}
                            </a>
                        {% endfor %}
                    {% else %}
                        <a href="#" class="btn btn-default">
                            <i class="fa fa-download"></i>
                            {% trans "Download files" %}
                        </a>
                        {% spaceless %}
                            (<ul class="list-inline list-truly-inline list-inline-commaseparated">
                                {% for filemeta in delivery.filemetas.all %}
                                    <li>
                                        <a href="#">{{ filemeta.filename }}</a>
                                    </li>
                                {% endfor %}
                            </ul>)
                        {% endspaceless %}
                    {% endif %}
                </div>
            {% endif %}
        {% endwith %}
    </div>

    {% if edit_feedback %}
        <div class="edit-feedback-box">
            <script src="{% static 'devilry_examiner/js/edit_feedback.js' %}"></script>
            {% include "devilry_examiner/edit-feedback.django.html" with js_editor_api_name="DevilryFeedbackEditor" %}
        </div>
    {% else %}
        <div class="container read-feedback-box">
            {% include "devilry_examiner/readonly-feedback-with-editbutton.django.html" with feedback=delivery.last_feedback only %}
        </div>
    {% endif %}
{% endblock %}
