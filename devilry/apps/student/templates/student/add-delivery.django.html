{% extends "student/base.django.js" %}
{% load extjs %}

{% block imports %}
    {{ block.super }}
    Ext.require('devilry.student.FileUploadPanel');
    Ext.require('devilry.student.DeadlineTitle');
    Ext.require('devilry.extjshelpers.SingleRecordContainer');
{% endblock %}


{% block appjs %}
    {{ block.super }}

    {{ restfulapi.RestfulSimplifiedDelivery|extjs_model }};
    var ag_model = {{ restfulapi.RestfulSimplifiedAssignmentGroup|extjs_model:"subject,period,assignment,users" }};
{% endblock %}

{% block onready %}
    {{ block.super }}
    var agroup_recordcontainer = Ext.create('devilry.extjshelpers.SingleRecordContainer');
    ag_model.load({{assignmentgroupid}}, {
        success: function(record) {
            Ext.getBody().unmask();
            agroup_recordcontainer.setRecord(record);
        }
    });

    Ext.create('Ext.container.Viewport', {
        layout: 'border',
        cls: 'viewport',
        items: [{
            region: 'north',
            xtype: 'pageheader',
            navclass: 'student'
        }, {
            region: 'south',
            xtype: 'pagefooter'
        }, {
            region: 'center',
            xtype: 'container',
            padding: {left: 20, right: 20},
            border: false,
            layout: {
                type: 'vbox',
                align: 'stretch'
            },
            items: [{
                xtype: 'deadlinetitle',
                singlerecordontainer: agroup_recordcontainer,
                //flex: 1,
                extradata: {
                    latest_deadline: new Date({{ deadline_timestamp_milliseconds}})
                }
            }, {
                xtype: 'fileuploadpanel',
                flex: 1,
                autoScroll: true,
                //border: false,
                margin: { top: 20 },
                bodyPadding: 20,
                assignmentgroupid: {{ assignmentgroupid }},
                deadlineid: {{ deadlineid }},
                initialhelptext: 'Upload files for your delivery. You can upload multiple files.',
                deliverymodelname: {{ restfulapi.RestfulSimplifiedDelivery|extjs_modelname }},
                agroup_recordcontainer: agroup_recordcontainer
            }]
        }]
    });
{% endblock %}
