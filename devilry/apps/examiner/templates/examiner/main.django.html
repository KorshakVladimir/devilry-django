{% extends "examiner/base.django.html" %}
{% load extjs %}

{% block headextra %}
{{ block.super }}
<script>
    Ext.onReady(function() {
        var dashboard_assignment_model = {{ RestfulSimplifiedAssignment|extjs_model:"subject,period" }}
        
        var dashboard_assignment_store = Ext.create('Ext.data.Store', {
            model: dashboard_assignment_model,
            groupField: 'parentnode__parentnode__long_name',
            remoteFilter: true,
            remoteSort: true,
            autoSync: true
        });

        //dashboard_assignment_store.proxy.extraParams.result_fieldgroups = Ext.JSON.encode(["subject"]);
        
        dashboard_assignment_store.load();        
        
        var groupingFeature = Ext.create('Ext.grid.feature.Grouping',{
            groupHeaderTpl: '{name}',
        });
        
        
        var listView = Ext.create('Ext.grid.Panel', {
            frame: false,
            frameHeader: false,
            border: false,
            sortableColumns: false,
            renderTo: 'dashtable',
            cls: 'selectable-grid',
            store: dashboard_assignment_store,
            features: [groupingFeature],
            columns: [{
                text: 'Assignment',
                menuDisabled: true,
                flex: 30,
                dataIndex: 'long_name'
            },{
                text: 'Period',
                menuDisabled: true,
                dataIndex: 'parentnode__long_name',
                flex: 20,
            },{
                text: 'Published',
                menuDisabled: true,
                flex: 15,
                dataIndex: 'publishing_time',
                renderer: function(value) {
                    var rowTpl = Ext.create('Ext.XTemplate',
                        '{.:date}'
                    );
                    return rowTpl.apply(value);
                }
            }],
            listeners: {
                scope: this,
                itemmouseup: function(view, record) {
                    var url = DASHBOARD_URL + "assignment/" + record.data.id
                    window.location = url;
                }
            }
        });
    });


</script>

{% endblock %}


{% block main %}
{{ block.super }}
<section>
    <h1>Assignments</h1>
    <section id="dashtable"></section>
</section>
{% endblock %}
