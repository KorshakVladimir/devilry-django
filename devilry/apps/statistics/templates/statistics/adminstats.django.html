{% extends "theme/no-body.django.html" %}
{% load extjs %}

{% block title %}Statistics{% endblock %}


{% block headextra %}

<script>
    var period_model = {{ RestfulSimplifiedPeriod|extjs_model }};
    var assignment_model = {{ RestfulSimplifiedAssignment|extjs_model }};
    var assignment_store = {{ RestfulSimplifiedAssignment|extjs_store }};
    var assignmentgroup_model = {{ RestfulSimplifiedAssignmentGroup|extjs_model:"assignment,users,feedback" }};
    var assignmentgroup_store = {{ RestfulSimplifiedAssignmentGroup|extjs_store }};

    

    Ext.require('devilry.statistics.Loader');
    Ext.onReady(function() {
        Ext.getBody().mask("Loading page", 'page-load-mask');
        Ext.create('devilry.statistics.Loader', {{ periodid }}, {
            listeners: {
                loaded: function(loader) {
                    Ext.getBody().unmask();
                    console.log(loader.students);
                    console.log(loader.columns);

                    var store = Ext.create('Ext.data.Store', {
                        fields: loader.fields,
                        data: {'items': loader.students},
                        proxy: {
                            type: 'memory',
                            reader: {
                                type: 'json',
                                root: 'items'
                            }
                        }
                    });

                    Ext.create('Ext.panel.Panel', {
                        layout: 'fit',
                        items: [{
                            xtype: 'grid',
                            store: store,
                            columns: loader.columns,
                            //width: 800,
                            //height: 600,
                            renderTo: Ext.getBody()
                        }]
                    });
                }
            }
        });
    });
</script>

{% endblock %}
