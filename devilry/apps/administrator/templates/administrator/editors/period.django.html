{% extends "theme/base.django.html" %}
{% load extjs %}
{% load i18n %}

{% block headextra %}

<script>
    {{ RestfulSimplifiedPeriod|extjs_model }}
    var periodstore = {{ RestfulSimplifiedPeriod|extjs_store }}
    //periodstore.load();


    function loadNode(node) {
    }

    function loadRecordFromStore(id) {
        // Load the request record into the form
        Ext.ModelManager.getModel({{ RestfulSimplifiedPeriod|get_extjsname_from_class }}).load(id, {
            success: function(node) {
                var form = Ext.getCmp('editform');
                form.loadRecord(node);
                var title = Ext.String.format('{0} ({1})', node.data.long_name, node.data.short_name);
                form.setTitle(title);
            }
        });
    }


    function loadUpdateMode(id) {
        loadRecordFromStore({{ record_id }});
        Ext.getCmp('maincarddeck').getLayout().setActiveItem('editcard');
    }



    var editform = {
        xtype: 'form',
        id: 'editform',
        layout: 'fit',
        disabled: true,
        model: {{ RestfulSimplifiedPeriod|get_extjsname_from_class}},

        defaultType: 'textfield',
        items: {{ RestfulSimplifiedPeriod|extjs_form_items}}
    };



    Ext.onReady(function() {
        Ext.create('devilry.extjshelpers.RestfulSimplifiedLayout', {
            id: 'maincarddeck',
            renderTo: 'maincarddeck-wrapper',
            editform: editform,
            supports_delete: {{ RestfulSimplifiedPeriod.supports_delete|yesno:"true,false" }}
        });

        {% if initial_mode == "update" or initial_mode == "create" %}
            {% if initial_mode == "update" %}
                loadUpdateMode();
            {% endif %}
        {% else %}
            Ext.getCmp('maincarddeck').getLayout().setActiveItem('overview');
        {% endif %}

    });
</script>
{% endblock %}


{% block main %}
<div id='maincarddeck-wrapper'></div>
{% endblock %}
