{% extends "theme/base.django.html" %}
{% load extjs %}

{% block title %}Devilry admin interface{% endblock %}

{% block headextra %}

<script>

    {% for RestfulCls in restfulclasses %}
        {{ RestfulCls|extjs_combobox_model }}
    {% endfor %}

    var nodestore = {{ RestfulSimplifiedNode|extjs_store:3 }}
    var subjectstore = {{ RestfulSimplifiedSubject|extjs_store:3 }}
    var periodstore = {{ RestfulSimplifiedPeriod|extjs_store:3 }}
    var assignmentstore = {{ RestfulSimplifiedAssignment|extjs_store:3 }}
    var assignmentgroupstore = {{ RestfulSimplifiedAssignmentGroup|extjs_store:3 }}
    var deliverystore = {{ RestfulSimplifiedDelivery|extjs_store:3 }}

    Ext.require('devilry.administrator.SearchWidget');
    Ext.onReady(function() {
        var searchwidget = Ext.create('devilry.administrator.SearchWidget', {
            renderTo: 'searchwidget',
            searchResultItems: [{
                xtype: 'administratorsearchresults',
                title: 'Nodes',
                store: nodestore,
                editorurlprefix: '{% url administrator-editors-node %}',
                rowformattpl: '{{ RestfulSimplifiedNode.ExtjsModelMeta.combobox_tpl|escapejs }}'
            }, {
                xtype: 'administratorsearchresults',
                title: 'Subjects',
                store: subjectstore,
                editorurlprefix: '{% url administrator-editors-subject %}',
                rowformattpl: '{{ RestfulSimplifiedSubject.ExtjsModelMeta.combobox_tpl|escapejs }}'
            }, {
                xtype: 'administratorsearchresults',
                title: 'Periods',
                store: periodstore,
                editorurlprefix: '{% url administrator-editors-period %}',
                rowformattpl: '{{ RestfulSimplifiedPeriod.ExtjsModelMeta.combobox_tpl|escapejs }}'
            }, {
                xtype: 'administratorsearchresults',
                title: 'Assignments',
                store: assignmentstore,
                editorurlprefix: '{% url administrator-editors-assignment %}',
                rowformattpl: '{{ RestfulSimplifiedAssignment.ExtjsModelMeta.combobox_tpl|escapejs }}'
            }, {
                xtype: 'administratorsearchresults',
                title: 'Assignment groups',
                store: assignmentgroupstore,
                editorurlprefix: '{% url administrator-editors-assignmentgroup %}',
                rowformattpl: '{{ RestfulSimplifiedAssignmentGroup.ExtjsModelMeta.combobox_tpl|escapejs }}'
            }, {
                xtype: 'administratorsearchresults',
                title: 'Delivery',
                store: deliverystore,
                editorurlprefix: '{% url administrator-editors-delivery %}',
                rowformattpl: '{{ RestfulSimplifiedDelivery.ExtjsModelMeta.combobox_tpl|escapejs }}'
            }]
        });

        searchwidget.loadInitialValues();
        searchwidget.focusOnSearchfield();
    });
</script>

{% endblock %}


{% block main %}
<div id='searchwidget'></div>
<div id='form-example'></div>
{% endblock %}
