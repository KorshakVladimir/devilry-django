{% extends "administrator/base.django.html" %}
{% load extjs %}


{% block headextra %}

<script>
    var assignmentgroupmodel = {{ restfulapi.RestfulSimplifiedAssignmentGroup|extjs_model:"subject,period,assignment" }};
    var assignmentgroupstore = {{ restfulapi.RestfulSimplifiedAssignmentGroup|extjs_store }};

    {{ restfulapi.RestfulSimplifiedDeadline|extjs_model }};
    {{ restfulapi.RestfulSimplifiedDeadline|extjs_store }};

    {{ restfulapi.RestfulSimplifiedDelivery|extjs_model:"deadline,assignment_group" }};
    {{ restfulapi.RestfulSimplifiedDelivery|extjs_store }};

    {{ restfulapi.RestfulSimplifiedStaticFeedback|extjs_model }};
    {{ restfulapi.RestfulSimplifiedStaticFeedback|extjs_store }};

    {{ restfulapi.RestfulSimplifiedFileMeta|extjs_model }};
    {{ restfulapi.RestfulSimplifiedFileMeta|extjs_store }};

    {# These are used by the grade editor #}
    {{ RestfulSimplifiedConfig|extjs_model }};
    {{ RestfulSimplifiedConfig|extjs_store }};
    {{ RestfulSimplifiedFeedbackDraft|extjs_model }};
    {{ RestfulSimplifiedFeedbackDraft|extjs_store }};


    Ext.require('devilry.extjshelpers.assignmentgroup.AssignmentGroupOverview');
    Ext.require('devilry.extjshelpers.SingleRecordContainer');
    Ext.onReady(function() {
        var assignmentgroup_recordcontainer = Ext.create('devilry.extjshelpers.SingleRecordContainer');
        var delivery_recordcontainer = Ext.create('devilry.extjshelpers.SingleRecordContainer');
        Ext.create('devilry.extjshelpers.assignmentgroup.AssignmentGroupOverview', {
            renderTo: 'maincontent',
            assignmentgroup_recordcontainer: assignmentgroup_recordcontainer,
            delivery_recordcontainer: delivery_recordcontainer,

            assignmentgroupid: {{ objectid }},
            assignmentgroupmodel: Ext.ModelManager.getModel('devilry.apps.administrator.simplified.SimplifiedAssignmentGroup'),
            assignmentgroupstore: assignmentgroupstore,
            deliverymodel: Ext.ModelManager.getModel('devilry.apps.administrator.simplified.SimplifiedDelivery'),
            deadlinestore: Ext.data.StoreManager.lookup('devilry.apps.administrator.simplified.SimplifiedDeadlineStore'),
            filemetastore: Ext.data.StoreManager.lookup('devilry.apps.administrator.simplified.SimplifiedFileMetaStore'),
            staticfeedbackstore: Ext.data.StoreManager.lookup('devilry.apps.administrator.simplified.SimplifiedStaticFeedbackStore'),
            canExamine: true
        });

        //assignmentgroupstore.proxy.extraParams.limit = 1;
        //assignmentgroupstore.proxy.extraParams.start = 0;
        //assignmentgroupstore.pageSize = 1;
        //assignmentgroupstore.proxy.extraParams.filters = Ext.JSON.encode([{
            //field: 'id',
            //comp: 'exact',
            //value: {{ objectid }}
        //}]);

        //assignmentgroupstore.load();
    
        assignmentgroupmodel.load({{ objectid }}, {
            success: function(record) {
                assignmentgroup_recordcontainer.setRecord(record);
            }
        });
    });

</script>

{% endblock %}


{% block main %}

<div id="maincontent"></div>

{% endblock %}
