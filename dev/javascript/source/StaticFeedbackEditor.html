<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js"><span id='devilry-extjshelpers-assignmentgroup-StaticFeedbackEditor'>/** Panel to show StaticFeedback info and create new static feedbacks.
</span> */
Ext.define('devilry.extjshelpers.assignmentgroup.StaticFeedbackEditor', {
    extend: 'devilry.extjshelpers.assignmentgroup.StaticFeedbackInfo',
    alias: 'widget.staticfeedbackeditor',
    requires: [
        'devilry.gradeeditors.DraftEditorWindow',
        'devilry.gradeeditors.RestfulRegistryItem'
    ],

    config: {
<span id='devilry-extjshelpers-assignmentgroup-StaticFeedbackEditor-cfg-gradeeditor_config_recordcontainer'>        /**
</span>         * @cfg
         * A {@link devilry.extjshelpers.SingleRecordContainer} for GradeEditor Config.
         */
        gradeeditor_config_recordcontainer: undefined,

<span id='devilry-extjshelpers-assignmentgroup-StaticFeedbackEditor-cfg-isAdministrator'>        /**
</span>         * @cfg
         * Use the administrator RESTful interface to store drafts? If this is
         * ``false``, we use the examiner RESTful interface.
         */
        isAdministrator: false
    },

    constructor: function(config) {
        return this.callParent([config]);
    },

    initComponent: function() {
        this.callParent(arguments);

        var me = this;
        this.createButton = Ext.create('Ext.button.Button', {
            text: 'New feedback',
            iconCls: 'icon-add-32',
            hidden: true,
            scale: 'large',
            listeners: {
                scope: this,
                click: this.loadGradeEditor
            }
        });
        this.infotableBottomToolbar.add('-&gt;');
        this.infotableBottomToolbar.add(this.createButton);
        this.infotableBottomToolbar.show();

        this.addListener('afterStoreLoadMoreThanZero', this.showCreateButton, this);

        if(this.delivery_recordcontainer.record) {
            this.onLoadDeliveryInEditor();
        }
        this.delivery_recordcontainer.addListener('setRecord', this.onLoadDeliveryInEditor, this);

        if(this.gradeeditor_config_recordcontainer.record) {
            this.onLoadGradeEditorConfig();
        }
        this.gradeeditor_config_recordcontainer.addListener('setRecord', this.onLoadGradeEditorConfig, this);

        this.registryitem_recordcontainer = Ext.create('devilry.extjshelpers.SingleRecordContainer');
        this.registryitem_recordcontainer.addListener('setRecord', this.onLoadRegistryItem, this);

    },

<span id='devilry-extjshelpers-assignmentgroup-StaticFeedbackEditor-method-onLoadDeliveryInEditor'>    /**
</span>     * @private
     * This is suffixed with InEditor to not crash with superclass.onLoadDelivery().
     */
    onLoadDeliveryInEditor: function() {
        this.showCreateButton();
    },

<span id='devilry-extjshelpers-assignmentgroup-StaticFeedbackEditor-method-onLoadGradeEditorConfig'>    /**
</span>     * @private
     */
    onLoadGradeEditorConfig: function() {
        this.loadRegistryItem();
    },

<span id='devilry-extjshelpers-assignmentgroup-StaticFeedbackEditor-method-loadRegistryItem'>    /**
</span>     * @private
     */
    loadRegistryItem: function() {
        var registryitem_model = Ext.ModelManager.getModel('devilry.gradeeditors.RestfulRegistryItem');
        registryitem_model.load(this.gradeeditor_config_recordcontainer.record.data.gradeeditorid, {
            scope: this,
            success: function(record) {
                this.registryitem_recordcontainer.setRecord(record);
            }
        });
    },

<span id='devilry-extjshelpers-assignmentgroup-StaticFeedbackEditor-method-onLoadRegistryItem'>    /**
</span>     * @private
     */
    onLoadRegistryItem: function() {
        this.showCreateButton();
    },

<span id='devilry-extjshelpers-assignmentgroup-StaticFeedbackEditor-method-showCreateButton'>    /**
</span>     * @private
     * Show create button when:
     *
     * - Delivery has loaded.
     * - Grade editor config has loaded.
     * - Registry item has loaded.
     */
    showCreateButton: function() {
        if(this.gradeeditor_config_recordcontainer.record &amp;&amp;
                this.delivery_recordcontainer.record &amp;&amp;
                this.registryitem_recordcontainer.record) {
            this.createButton.show();
        }
    },

<span id='devilry-extjshelpers-assignmentgroup-StaticFeedbackEditor-method-loadGradeEditor'>    /**
</span>     * @private
     */
    loadGradeEditor: function() {
        Ext.widget('gradedrafteditormainwin', {
            deliveryid: this.delivery_recordcontainer.record.data.id,
            isAdministrator: this.isAdministrator,
            gradeeditor_config: this.gradeeditor_config_recordcontainer.record.data,
            registryitem: this.registryitem_recordcontainer.record.data,
            listeners: {
                scope: this,
                beforeclose: this.onCloseGradeEditor
            }
        }).show();
    },

<span id='devilry-extjshelpers-assignmentgroup-StaticFeedbackEditor-method-bodyWithNoFeedback'>    /**
</span>     * Overrides parent method to enable examiners to click to create feedback.
     */
    bodyWithNoFeedback: function() {
        var me = this;
        this.setBody({
            xtype: 'component',
            cls: 'no-feedback-editable',
            html: '&lt;p&gt;No feedback&lt;/p&gt;&lt;p class=&quot;unimportant&quot;&gt;Click to create feedback&lt;/p&gt;',
            listeners: {
                render: function() {
                    this.getEl().addListener('mouseup', me.loadGradeEditor, me);
                }
            }
        });
    },

<span id='devilry-extjshelpers-assignmentgroup-StaticFeedbackEditor-method-onCloseGradeEditor'>    /**
</span>     * @private
     */
    onCloseGradeEditor: function() {
        this.onLoadDelivery();
    }
});
</pre>
</body>
</html>
