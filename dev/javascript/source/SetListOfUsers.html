<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">Ext.define('devilry.extjshelpers.SetListOfUsers', {
    extend: 'Ext.panel.Panel',
    alias: 'widget.setlistofusers',
    frame: false,
    border: false,

    config: {
<span id='global-cfg-usernames'>        /**
</span>         * @cfg
         * Usernames to fill in on load.
         */
        usernames: [],

        buttonLabel: 'Save',

        example: 'bob\nalice\neve\ndave',
        helptext: '&lt;p&gt;One username on each line. Example:&lt;/p&gt;',

        helptpl: Ext.create('Ext.XTemplate',
            '&lt;div class=&quot;section helpsection&quot;&gt;',
            '   {helptext}',
            '   &lt;pre style=&quot;padding: 5px;&quot;&gt;{example}&lt;/pre&gt;',
            '&lt;/div&gt;'
        )
    },


    constructor: function(config) {
        this.addEvents(
<span id='global-event-saveClicked'>            /**
</span>             * @event
             * Fired when the save button is clicked.
             *
             * @param setlistofusersobj This object.
             * @param usernames Array of usernames.
             */
            'saveClicked');
        this.initConfig(config);
        this.callParent([config]);
    },

    initComponent: function() {
        this.userinput = Ext.widget('textareafield', {
            fieldLabel: 'Usernames',
            flex: 12, // Take up all remaining vertical space
            margin: 10,
            labelAlign: 'top',
            labelWidth: 100,
            labelStyle: 'font-weight:bold'
        });
        this.setValueFromArray(this.usernames);

        var toolbarItems = ['-&gt;', {
            xtype: 'button',
            iconCls: 'icon-save-32',
            scale: 'large',
            text: this.buttonLabel,
            listeners: {
                scope: this,
                click: this.onSave
            }
        }];

        if(this.extraToolbarButtons) {
            Ext.Array.insert(toolbarItems, 0, this.extraToolbarButtons);
        }

        Ext.apply(this, {
            layout: {
                type: 'hbox',
                align: 'stretch'
            },

            items: [this.userinput, {
                flex: 10,
                xtype: 'box',
                padding: 10,
                html: this.helptpl.apply(this)
            }],

            dockedItems: [{
                xtype: 'toolbar',
                dock: 'bottom',
                ui: 'footer',
                items: toolbarItems
            }]
        });
        this.callParent(arguments);
    },

    parseInput: function(rawValue) {
        var asArray = rawValue.split('\n');
        var usernames = [];
        Ext.Array.each(asArray, function(username) {
            username = Ext.String.trim(username);
            if(username != &quot;&quot;) {
                usernames.push(username);
            }
        });
        return Ext.Array.unique(usernames);
    },

    setValueFromArray: function(arrayOfUsernames) {
        var currentValue = &quot;&quot;;
        Ext.each(arrayOfUsernames, function(username, index) {
            currentValue += Ext.String.format('{0}\n', username);
        });
        this.userinput.setValue(currentValue);
    },

<span id='global-method-onSave'>    /**
</span>     * @private
     */
    onSave: function() {
        var usernames = this.parseInput(this.userinput.getValue());
        this.fireEvent('saveClicked', this, usernames);
    }
});
</pre>
</body>
</html>
