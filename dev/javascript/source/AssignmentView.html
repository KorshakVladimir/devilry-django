<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">Ext.define('devilry.examiner.AssignmentView', {
    extend: 'Ext.Container',
    frame: false,
    border: false,

    requires: [
        'devilry.extjshelpers.studentsmanager.StudentsManager',
        'devilry.extjshelpers.assignmentgroup.AssignmentGroupTodoList',
        'devilry.extjshelpers.charts.PointsOfGroupsOnSingleAssignment'
    ],

    config: {
        assignment_recordcontainer: undefined,
        assignmentmodelname: undefined,
        assignmentid: undefined,
        assignmentgroupstore: undefined
    },

    constructor: function(config) {
        this.initConfig(config);
        this.callParent([config]);
    },

    initComponent: function() {
        this._todolist = Ext.widget('assignmentgrouptodolist', {
            store: this.assignmentgroupstore,
            height: 350,
            toolbarExtra: ['-&gt;', {
               xtype: 'button',
               scale: 'large',
               text: 'Download all deliveries',
               listeners: {
                   scope: this,
                   click: this.onDownload
               }
            }, {
               xtype: 'button',
               scale: 'large',
               text: 'Manage assignment groups (students)',
               listeners: {
                   scope: this,
                   click: this.onStudents
               }
            }],
            
            helpTpl: Ext.create('Ext.XTemplate',
                '&lt;div class=&quot;section helpsection&quot;&gt;',
                '   {todohelptext}',
                '   &lt;p&gt;Choose &lt;span class=&quot;menuref&quot;&gt;Manage assignment groups (students)&lt;/span&gt; to view all groups, and to give feedback to multiple groups.&lt;/p&gt;',
                '   &lt;p&gt;You may want to &lt;span class=&quot;menuref&quot;&gt;Download all deliveries&lt;/span&gt; as a zip file instead of downloading the delivery for each group separately. This will download all deliveries from all assignment groups where you are examiner on this assignment, not just the deliveries in your todo-list.&lt;/p&gt;',
                '&lt;/div&gt;'
            ),

            onSelectGroup: function(grid, assignmentgroupRecord) {
                var url = Ext.String.format('../assignmentgroup/{0}',
                    assignmentgroupRecord.data.id
                );
                window.location.href = url;
            },
        });


        Ext.apply(this, {
            items: [{
                xtype: 'panel',
                title: 'To-do list',
                frame: false,
                items: [this._todolist]
            }]
                //xtype: 'panel',
                //title: 'Overview',
                //margin: {
                    //top: 30
                //},
                //layout: 'fit',
                //height: 800,
                //width: &quot;100%&quot;,
                //items: {
                    //xtype: 'chart_pointsofgroupsonsingleassignment',
                    //store: this.assignmentgroupGraphstore
                //}
            //}]
        });
        this.callParent(arguments);

        var assignmentmodel = Ext.ModelManager.getModel(this.assignmentmodelname);
        assignmentmodel.load(this.assignmentid, {
            scope: this,
            success: this.onLoadAssignmentSuccess,
            failure: this.onLoadAssignmentFailure
        });
        this.loadTodoList();


        //this.assignmentgroupGraphstore.proxy.extraParams.filters = Ext.JSON.encode([{
            //field: 'parentnode',
            //comp: 'exact',
            //value: this.assignmentid
        //}]);
        //this.assignmentgroupGraphstore.load({
            //callback: function(records) {
                ////console.log(records[0].data);
            //}
        //});
    },

    loadTodoList: function() {
        this._todolist.loadTodoListForAssignment(this.assignmentid);
    },

    onLoadAssignmentSuccess: function(record) {
        this.assignment_recordcontainer.setRecord(record);
        //this.onStudents();
    },

    onLoadAssignmentFailure: function() {
        throw &quot;Failed to load assignment&quot;;
    },

    onStudents: function(button) {
        this.hide();
        var studentswindow = Ext.create('Ext.window.Window', {
            title: 'Students',
            width: 926,
            height: 500,
            layout: 'fit',
            maximizable: false,
            modal: true,
            maximized: true,
            items: {
                xtype: 'studentsmanager',
                assignmentgroupstore: this.assignmentgroupstore,
                assignmentid: this.assignmentid,
                assignmentrecord: this.assignment_recordcontainer.record,
                deadlinemodel: Ext.ModelManager.getModel('devilry.apps.examiner.simplified.SimplifiedDeadline'),
                gradeeditor_config_model: Ext.ModelManager.getModel('devilry.apps.gradeeditors.simplified.examiner.SimplifiedConfig'),
                isAdministrator: false
            },
            listeners: {
                scope: this,
                close: function() {
                    this.show();
                    this.loadTodoList();
                }
            }
        });
        studentswindow.show();
    },

    onDownload: function() {
        window.location.href = Ext.String.format('compressedfiledownload/{0}', this.assignmentid);
    }
});
</pre>
</body>
</html>
