<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">Ext.define('devilry.statistics.OverviewOfSingleStudent', {
    extend: 'Ext.container.Container',
    alias: 'widget.statistics-overviewofsinglestudent',
    requires: [
        'devilry.statistics.OverviewOfSingleStudentRecord',
        'devilry.statistics.SingleStudentPeriodChart'
    ],
    
    config: {
        assignmentgroups: undefined,
        assignment_store: undefined,
        labelKeys: undefined
    },

    mainTpl: Ext.create('Ext.XTemplate',
        '&lt;div style=&quot;margin-bottom: 5px&quot;&gt;',
        '   &lt;ul class=&quot;labels-list&quot;&gt;',
        '       &lt;tpl for=&quot;labelKeys&quot;&gt;',
        '          &lt;li class=&quot;label-{.}&quot;&gt;{.}&lt;/li&gt;',
        '       &lt;/tpl&gt;',
        '   &lt;/ul&gt;',
        '&lt;/div&gt;',
        '&lt;table class=&quot;horizontalinfotable&quot;&gt;',
        '   &lt;thead&gt;&lt;tr&gt;',
        '       &lt;th&gt;Assignment&lt;/th&gt;',
        '       &lt;th&gt;Points (no scaling)&lt;/th&gt;',
        '       &lt;th&gt;Grade&lt;/th&gt;',
        '       &lt;th&gt;Passing grade?&lt;/th&gt;',
        '       &lt;th&gt;Open?&lt;/th&gt;',
        '   &lt;/tr&gt;&lt;/thead&gt;',
        '   &lt;tbody&gt;',
        '      &lt;tpl for=&quot;store.data.items&quot;&gt;',
        '         &lt;tr&gt;',
        '             &lt;td&gt;&lt;a href=&quot;{parent.DEVILRY_URLPATH_PREFIX}/administrator/assignmentgroup/{data.id}&quot; target=&quot;_blank&quot;&gt;{data.assignment__long_name}&lt;/a&gt;&lt;/td&gt;',
        '             &lt;td&gt;{data.feedback__points}&lt;/td&gt;',
        '             &lt;td&gt;{data.feedback__grade}&lt;/td&gt;',
        '             &lt;td&gt;',
        '                 &lt;tpl if=&quot;data.feedback === null&quot;&gt;',
        '                    &lt;span class=&quot;nofeedback&quot;&gt;No feedback&lt;/span&gt;',
        '                 &lt;/tpl&gt;',
        '                 &lt;tpl if=&quot;data.feedback !== null&quot;&gt;',
        '                    &lt;tpl if=&quot;data.feedback__is_passing_grade&quot;&gt;Yes&lt;/tpl&gt;',
        '                    &lt;tpl if=&quot;!data.feedback__is_passing_grade&quot;&gt;No&lt;/tpl&gt;',
        '                 &lt;/tpl&gt;',
        '             &lt;/td&gt;',
        '             &lt;td&gt;',
        '                &lt;tpl if=&quot;data.is_open&quot;&gt;Yes&lt;/tpl&gt;',
        '                &lt;tpl if=&quot;!data.is_open&quot;&gt;No&lt;/tpl&gt;',
        '             &lt;/td&gt;',
        '         &lt;/tr&gt;',
        '      &lt;/tpl&gt;',
        '   &lt;/tbody&gt;',
        '   &lt;tfoot&gt;',
        '      &lt;tr&gt;',
        '          &lt;td&gt;Total points&lt;/td&gt;',
        '          &lt;td&gt;{total_points}&lt;/td&gt;',
        '      &lt;/tr&gt;',
        '   &lt;/tfoot&gt;',
        '&lt;/table&gt;'
    ),

    autoScroll: true,
    padding: 10,
    
    constructor: function(config) {
        this.initConfig(config);

        this.store = Ext.create('Ext.data.Store', {
            model: 'devilry.statistics.OverviewOfSingleStudentRecord',
            autoSync: false,
            proxy: 'memory'
        });
        this.total_points = 0;
        Ext.each(this.assignmentgroups, function(assignmentgroup, index) {
            var assignmentRecord = this.assignment_store.getById(assignmentgroup.parentnode);
            this.total_points += assignmentgroup.feedback__points;
            this.store.add({
                id: assignmentgroup.id,
                assignmentid: assignmentRecord.get('id'),
                assignment__short_name: assignmentRecord.get('short_name'),
                assignment__long_name: assignmentRecord.get('long_name'),
                is_open: assignmentgroup.is_open,
                feedback: assignmentgroup.feedback,
                feedback__points: assignmentgroup.feedback__points,
                feedback__grade: assignmentgroup.feedback__grade,
                feedback__is_passing_grade: assignmentgroup.feedback__is_passing_grade
            });
        }, this);

        this.callParent([config]);
    },
    
    initComponent: function() {
        this.DEVILRY_URLPATH_PREFIX = DevilrySettings.DEVILRY_URLPATH_PREFIX;
        Ext.apply(this, {
            layout: {
                type: 'hbox',
                align: 'stretch'
            },
            items: [{
                xtype: 'box',
                autoScroll: true,
                html: this.mainTpl.apply(this),
                flex: 6
            //}, {
                //xtype: 'statistics-singlestudentperiodchart',
                //store: this.store,
                //flex: 4
            }]
        });
        this.callParent(arguments);
    },

    //_loadAssignmentGroups: function() {
        //this.candidate_store = Ext.create('Ext.data.Store', {
            //model: Ext.String.format('devilry.apps.{0}.simplified.SimplifiedCandidate', this.role),
            //remoteFilter: true,
            //remoteSort: true
        //});
        //this.candidate_store.pageSize = 100000; // TODO: avoid UGLY hack
        //this.candidate_store.proxy.setDevilryFilters([{
            //field: 'assignment_group__parentnode__parentnode',
            //comp: 'exact',
            //value: this.periodid
        //}, {
            //field: 'student',
            //comp: 'exact',
            //value: this.userid
        //}]);
        //this.candidate_store.load({
            //scope: this,
            //callback: this._onCandidatesLoaded
        //});
    //},

    //_onCandidatesLoaded: function(records) {
        //console.log(records);
    //}
});
</pre>
</body>
</html>
