<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">Ext.define('devilry.extjshelpers.assignmentgroup.DeliveriesGrid', {
    extend: 'Ext.grid.Panel',
    alias: 'widget.deliveriesgrid',
    cls: 'widget-deliveriesgrid selectable-grid',
    hideHeaders: true, // Hide column header
    mixins: [
        'devilry.extjshelpers.AddPagerIfNeeded'
    ],

    rowTpl: Ext.create('Ext.XTemplate',
        '&lt;div style=&quot;white-space:normal; line-height: 1.5em !important;&quot;&gt;',
        //'&lt;span&gt;({delivery.id})&lt;/span&gt; ',
        '&lt;span class=&quot;delivery_number&quot;&gt;{delivery.number}:&lt;/span&gt; ',
        '&lt;tpl if=&quot;assignmentgroup.parentnode__delivery_types === 1&quot;&gt;',
        '    &lt;span class=&quot;not_in_devilry&quot;&gt;Autogenerated by examiner&lt;/span&gt;',
        '&lt;/tpl&gt;',
        '&lt;tpl if=&quot;assignmentgroup.parentnode__delivery_types !== 1&quot;&gt;',
        '    &lt;span class=&quot;time_of_delivery&quot;&gt;{delivery.time_of_delivery:date}&lt;/span&gt;',
        '    &lt;tpl if=&quot;delivery.delivery_type == 0&quot;&gt;',
        '       &lt;tpl if=&quot;delivery.time_of_delivery &amp;gt; deadline.deadline&quot;&gt;',
        '          &lt;span class=&quot;warningInlineItem&quot;&gt;After deadline&lt;/span&gt;',
        '       &lt;/tpl&gt;',
        '    &lt;/tpl&gt;',
        '&lt;/tpl&gt;',
        '&lt;tpl if=&quot;delivery.delivery_type == 2&quot;&gt;',
        '   &lt;span class=&quot;neutralInlineItem&quot;&gt;From previous period (semester)&lt;/span&gt;',
        '&lt;/tpl&gt;',
        '&lt;tpl if=&quot;hasLatestFeedback&quot;&gt;',
        '   &lt;span class=&quot;neutralInlineItem&quot;&gt;active feedback&lt;/span&gt;',
        '&lt;/tpl&gt;',
        '&lt;tpl if=&quot;feedback&quot;&gt;',
        '   &lt;span class=&quot;has-feedback&quot; style=&quot;white-space:no-wrap&quot;&gt;({feedback.grade})&lt;/span&gt;',
        '&lt;/tpl&gt;',
        '&lt;/div&gt;'
    ),

    config: {
        assignmentgroup_recordcontainer: undefined,
        deadlineRecord: undefined,

<span id='global-cfg-delivery_recordcontainer'>        /**
</span>         * @cfg
         * A {@link devilry.extjshelpers.SingleRecordContainer} for Delivery.
         * The record is changed when a user selects a delivery.
         */
        delivery_recordcontainer: undefined
    },

    constructor: function(config) {
        this.callParent([config]);
        this.initConfig(config);
    },

    initComponent: function() {

        var me = this;
        Ext.apply(this, {
            columns: [{
                header: 'Data',
                dataIndex: 'id',
                flex: 1,
                renderer: function(value, metaData, deliveryrecord) {
                    //console.log(deliveryrecord.data);
                    var staticfeedbackStore = deliveryrecord.staticfeedbacks();
                    return this.rowTpl.apply({
                        delivery: deliveryrecord.data,
                        hasLatestFeedback: deliveryrecord.hasLatestFeedback,
                        deadline: this.deadlineRecord.data,
                        assignmentgroup: this.assignmentgroup_recordcontainer.record.data,
                        feedback: staticfeedbackStore.count() &gt; 0? staticfeedbackStore.data.items[0].data: undefined
                    });
                }
            }],
            listeners: {
                scope: this,
                select: this.onSelectDelivery
            }
        });

        this.addPagerIfNeeded();
        this.callParent(arguments);
    },

<span id='global-method-onSelectDelivery'>    /**
</span>     * @private
     */
    onSelectDelivery: function(grid, deliveryRecord) {
        var allGrids = this.up('deliveriesgroupedbydeadline').query('deliveriesgrid');
        Ext.each(allGrids, function(grid, index) {
            if(grid !== this) {
                grid.getSelectionModel().deselectAll();
            }
        }, this);
        this.delivery_recordcontainer.setRecord(deliveryRecord);
    }
});
</pre>
</body>
</html>
