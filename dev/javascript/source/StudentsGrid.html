<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">Ext.define('devilry.extjshelpers.studentsmanager.StudentsGrid', {
    extend: 'Ext.grid.Panel',
    alias: 'widget.studentsmanager_studentsgrid',
    cls: 'widget-studentsmanager_studentsgrid',
    sortableColumns: false,

    config: {
        assignmentid: undefined
    },

    mixins: {
        canPerformActionsOnSelected: 'devilry.extjshelpers.GridPeformActionOnSelected'
    },

    candidatesCol: Ext.create('Ext.XTemplate', 
        '&lt;ul class=&quot;candidatescolumn&quot;&gt;',
        '    &lt;tpl for=&quot;candidates__identifier&quot;&gt;',
        '       &lt;li&gt;{.}&lt;/li&gt;',
        '    &lt;/tpl&gt;',
        '&lt;/ul&gt;'
    ),

    examinersCol: Ext.create('Ext.XTemplate', 
        '&lt;ul class=&quot;examinerscolumn&quot;&gt;',
        '    &lt;tpl for=&quot;examiners__username&quot;&gt;',
        '       &lt;li&gt;{.}&lt;/li&gt;',
        '    &lt;/tpl&gt;',
        '&lt;/ul&gt;'
    ),

    isOpenColTpl: Ext.create('Ext.XTemplate', 
        '&lt;span class=&quot;is_opencol&quot;&gt;',
        '    &lt;tpl if=&quot;is_open&quot;&gt;',
        '       &lt;span class=&quot;open&quot;&gt;Open&lt;/span&gt;',
        '    &lt;/tpl&gt;',
        '    &lt;tpl if=&quot;!is_open&quot;&gt;',
        '       &lt;span class=&quot;closed&quot;&gt;Closed&lt;/span&gt;',
        '   &lt;/tpl&gt;',
        '&lt;/span&gt;'
    ),

    deliveriesColTpl: Ext.create('Ext.XTemplate', 
        '&lt;span class=&quot;deliveriescol&quot;&gt;',
        '    &lt;tpl if=&quot;number_of_deliveries &amp;gt; 0&quot;&gt;',
        '       {number_of_deliveries}',
        '    &lt;/tpl&gt;',
        '    &lt;tpl if=&quot;number_of_deliveries == 0&quot;&gt;',
        '       &lt;span class=&quot;nodeliveries&quot;&gt;0&lt;/div&gt;',
        '   &lt;/tpl&gt;',
        '&lt;/span&gt;'
    ),

    pointsColTpl: Ext.create('Ext.XTemplate', 
        '&lt;span class=&quot;pointscolumn&quot;&gt;',
        '    &lt;tpl if=&quot;feedback&quot;&gt;',
        '       {feedback__points}',
        '    &lt;/tpl&gt;',
        '    &lt;tpl if=&quot;!feedback&quot;&gt;',
        '       &lt;span class=&quot;nofeedback&quot;&gt;&amp;empty;&lt;/span&gt;',
        '   &lt;/tpl&gt;',
        '&lt;/span&gt;'
    ),

    gradeColTpl: Ext.create('Ext.XTemplate', 
        '&lt;section class=&quot;gradecolumn&quot;&gt;',
        '   &lt;tpl if=&quot;feedback&quot;&gt;',
        '        &lt;div class=&quot;is_passing_grade&quot;&gt;',
        '           &lt;tpl if=&quot;feedback__is_passing_grade&quot;&gt;&lt;span class=&quot;passing_grade&quot;&gt;Passed&lt;/span&gt;&lt;/tpl&gt;',
        '           &lt;tpl if=&quot;!feedback__is_passing_grade&quot;&gt;&lt;span class=&quot;not_passing_grade&quot;&gt;Failed&lt;/span&gt;&lt;/tpl&gt;',
        '           : &lt;span class=&quot;grade&quot;&gt;{feedback__grade}&lt;/span&gt;',
        '        &lt;/div&gt;',
        '        &lt;div class=&quot;delivery_type&quot;&gt;',
        '            &lt;tpl if=&quot;feedback__delivery__delivery_type == 0&quot;&gt;&lt;span class=&quot;electronic&quot;&gt;Electronic&lt;/span&gt;&lt;/tpl&gt;',
        '            &lt;tpl if=&quot;feedback__delivery__delivery_type == 1&quot;&gt;&lt;span class=&quot;non-electronic&quot;&gt;Non-electronic&lt;/span&gt;&lt;/tpl&gt;',
        '            &lt;tpl if=&quot;feedback__delivery__delivery_type == 2&quot;&gt;&lt;span class=&quot;alias&quot;&gt;From previous period&lt;/span&gt;&lt;/tpl&gt;',
        '            &lt;tpl if=&quot;feedback__delivery__delivery_type &amp;gt; 2&quot;&gt;&lt;span class=&quot;unknown&quot;&gt;Unknown delivery type&lt;/span&gt;&lt;/tpl&gt;',
        '       &lt;/div&gt;',
        '   &lt;/tpl&gt;',
        '    &lt;tpl if=&quot;!feedback&quot;&gt;',
        '        &lt;div class=&quot;nofeedback&quot;&gt;',
        '           No feedback',
        '        &lt;/div&gt;',
        '    &lt;/tpl&gt;',
        '&lt;/section&gt;'
    ),

    constructor: function(config) {
        this.callParent([config]);
        this.initConfig(config);
    },

    initComponent: function() {
        this.store.pageSize = 30;
        this.store.proxy.extraParams.filters = Ext.JSON.encode([{
            field: 'parentnode',
            comp: 'exact',
            value: this.assignmentid
        }]);


        this.selModel = Ext.create('Ext.selection.CheckboxModel', {
            checkOnly: true,
            listeners: {
                click: function() {
                    console.log('hei');
                }
            }
        });

        Ext.apply(this, {
            dockedItems: [{
                xtype: 'pagingtoolbar',
                store: this.store,
                dock: 'bottom',
                displayInfo: true
            }],

            columns: [{
                text: 'Open?', dataIndex: 'id', width: 60,
                renderer: this.formatIsOpenCol
            }, {
                text: 'Group name', dataIndex: 'name', flex: 4
            }, {
                text: 'Students', dataIndex: 'id', flex: 4,
                renderer: this.formatCandidatesCol
            }, {
                text: 'Examiners', dataIndex: 'id', flex: 4,
                renderer: this.formatExaminersCol
            }, {
                text: 'Deliveries', dataIndex: 'id', flex: 2,
                renderer: this.formatDeliveriesCol
            }, {
                text: 'Latest feedback',
                columns: [{
                    text: 'Points',
                    dataIndex: 'feedback__points',
                    renderer: this.formatPointsCol,
                    width: 70
                }, {
                    text: 'Grade',
                    dataIndex: 'feedback__grade',
                    width: 150,
                    renderer: this.formatGradeCol
                }]
            }]
        });
        this.callParent(arguments);
        this.store.load();
    },

    formatIsOpenCol: function(value, p, record) {
        return this.isOpenColTpl.apply(record.data);
    },

    formatCandidatesCol: function(value, p, record) {
        return this.candidatesCol.apply(record.data);
    },

    formatExaminersCol: function(value, p, record) {
        return this.examinersCol.apply(record.data);
    },

    formatDeliveriesCol: function(value, p, record) {
        return this.deliveriesColTpl.apply(record.data);
    },

    formatPointsCol: function(value, p, record) {
        return this.pointsColTpl.apply(record.data);
    },

    formatGradeCol: function(value, p, record) {
        return this.gradeColTpl.apply(record.data);
    }
});
</pre>
</body>
</html>
