<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">Ext.define('devilry.statistics.ChooseAssignmentsGrid', {
    extend: 'Ext.grid.Panel',
    alias: 'widget.statistics-chooseassignmentsgrid',
    hideHeaders: true,
    title: 'Choose assignments',

    requires: [
        'devilry.extjshelpers.GridSelectionModel'
    ],

    config: {
        selectedAssignmentIds: undefined
    },
    
    constructor: function(config) {
        this.initConfig(config);
        this.callParent([config]);
    },
    
    initComponent: function() {
        this.selModel = Ext.create('devilry.extjshelpers.GridSelectionModel', {
            checkOnly: false
        });
        Ext.apply(this, {
            columns: [{
                header: 'Long name',  dataIndex: 'long_name', flex: 1
            }]
        });
        this.on('render', function() {
            if(this.selectedAssignmentIds) {
                this._selectByIds(this.selectedAssignmentIds);
            }
        }, this);
        this.callParent(arguments);
    },

    _selectByIds: function(assignmentIds) {
        var records = [];
        Ext.each(assignmentIds, function(assignmentId, index) {
            var record = this.store.getById(assignmentId);
            records.push(record);
        }, this);
        try {
            this.getSelectionModel().select(records);
        } catch(e) {
            Ext.defer(function() {
                this._selectByIds(assignmentIds);
            }, 300, this);
        }
    },

    getIdOfSelected: function() {
        var assignment_ids = [];
        Ext.each(this.getSelectionModel().getSelection(), function(assignmentRecord, index) {
            assignment_ids.push(assignmentRecord.get('id'));
        }, this);
        return assignment_ids;
    },


    checkAtLeastOneSelected: function() {
        var assignment_ids = this.getIdOfSelected();
        if(assignment_ids.length === 0) {
            Ext.MessageBox.alert('Invalid input', 'Please select at least one assignment');
            return false;
        }
        return true;
    }
});
</pre>
</body>
</html>
