<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">
<span id='devilry-extjshelpers-assignmentgroup-DeliveryInfo'>/**
</span> * Panel to show Delivery info.
 * Uses {@link devilry.extjshelpers.assignmentgroup.StaticFeedbackInfo}
 * or {@link devilry.extjshelpers.assignmentgroup.StaticFeedbackEditor}
 * to show and manage StaticFeedback (see {@link #canExamine})
 *
 *      -------------------------------------------
 *      | Info about the delivery                 |
 *      |                                         |
 *      |                                         |
 *      -------------------------------------------
 *      | StaticFeedbackInfo                      |
 *      | or                                      |
 *      | StaticFeedbackEditor              |
 *      |                                         |
 *      |                                         |
 *      |                                         |
 *      |                                         |
 *      -------------------------------------------
 */
Ext.define('devilry.extjshelpers.assignmentgroup.DeliveryInfo', {
    extend: 'Ext.panel.Panel',
    alias: 'widget.deliveryinfo',
    title: 'Delivery',
    cls: 'widget-deliveryinfo',
    html: '',
    requires: [
        'devilry.extjshelpers.assignmentgroup.StaticFeedbackEditor',
        'devilry.extjshelpers.assignmentgroup.StaticFeedbackInfo',
        'devilry.extjshelpers.assignmentgroup.FileMetaBrowserPanel'
    ],

    config: {
<span id='devilry-extjshelpers-assignmentgroup-DeliveryInfo-cfg-delivery'>        /**
</span>         * @cfg
         * A delivery object, such as ``data`` attribute of a
         * record loaded from a Delivery store or model.
         */
        delivery: undefined,

<span id='devilry-extjshelpers-assignmentgroup-DeliveryInfo-cfg-canExamine'>        /**
</span>         * @cfg
         * Enable creation of new feedbacks? Defaults to ``false``.
         *
         * If this is ``true``, 
         * {@link devilry.extjshelpers.assignmentgroup.StaticFeedbackEditor}
         * is used instead of
         * {@link devilry.extjshelpers.assignmentgroup.StaticFeedbackInfo}.
         *
         * If this is ``true``, the ``assignmentid`` config is _required_.
         *
         * When this is ``true``, the authenticated user still needs to have
         * permission to POST new feedbacks for the view to work.
         */
        canExamine: false,

<span id='devilry-extjshelpers-assignmentgroup-DeliveryInfo-cfg-assignmentid'>        /**
</span>        * @cfg
        * Assignment id. Required for 
        * {@link devilry.extjshelpers.assignmentgroup.StaticFeedbackEditor},
        * which is used if the ``canExamine`` config is ``true``.
        */
        assignmentid: undefined,

<span id='devilry-extjshelpers-assignmentgroup-DeliveryInfo-cfg-filemetastore'>        /**
</span>         * @cfg
         * FileMeta ``Ext.data.Store``. (Required).
         * _Note_ that ``filemetastore.proxy.extraParams`` is changed by this
         * class.
         */
        filemetastore: undefined,

<span id='devilry-extjshelpers-assignmentgroup-DeliveryInfo-cfg-staticfeedbackstore'>        /**
</span>         * @cfg
         * FileMeta ``Ext.data.Store``. (Required).
         * _Note_ that ``filemetastore.proxy.extraParams`` is changed by
         * {@link devilry.extjshelpers.assignmentgroup.StaticFeedbackInfo}.
         */
        staticfeedbackstore: undefined
    },

    tpl: Ext.create('Ext.XTemplate',
        'Time of delivery: &lt;em&gt;{time_of_delivery:date}&lt;/em&gt;'
    ),

    initComponent: function() {
        var clsname = this.canExamine? 'StaticFeedbackEditor': 'StaticFeedbackInfo';
        this.feedbackInfo = Ext.create('devilry.extjshelpers.assignmentgroup.' + clsname, {
            deliveryid: this.delivery.id,
            staticfeedbackstore: this.staticfeedbackstore,
            assignmentid: this.assignmentid
        });

        var me = this;
        Ext.apply(this, {
            items: [this.feedbackInfo],
            tbar: [{
                xtype: 'button',
                text: 'Browse files',
                listeners: {
                    scope: me,
                    click: me.showFileMetaBrowserWindow
                }
            }, '-&gt;', this.tpl.apply(this.delivery)]
        });
        this.callParent(arguments);
    },

    showFileMetaBrowserWindow: function() {
        Ext.create('Ext.window.Window', {
            title: 'Files',
            height: 400,
            width: 600,
            layout: 'fit',
            items: [{
                xtype: 'filemetabrowserpanel',
                border: false,
                filemetastore: this.filemetastore,
                deliveryid: this.delivery.id
            }]
        }).show();

    }
});
</pre>
</body>
</html>
